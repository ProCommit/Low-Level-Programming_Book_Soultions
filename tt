#!/usr/bin/env bash
#
# fix-gnome-stutter.sh
# ×××™×¥ ××ª GNOME, ×× ×§×” ×”×¨×—×‘×•×ª ×ª×§×•×¢×•×ª ×•××‘×˜×œ ×× ×™××¦×™×•×ª

echo "ğŸš€ ×× ×§×” ×”×¨×—×‘×•×ª ×¤×¢×™×œ×•×ª..."
for e in $(gnome-extensions list --enabled); do
    gnome-extensions disable "$e"
done

echo "âš™ï¸ ×××¤×¡ ×”×’×“×¨×•×ª Mutter ×•Ö¾GNOME..."
gsettings set org.gnome.desktop.interface enable-animations false
gsettings set org.gnome.mutter experimental-features "[]"
gsettings set org.gnome.mutter dynamic-workspaces false

# ×‘×™×˜×•×œ overview ×‘×œ×—×™×¦×” ×¢×œ Super
echo "ğŸ§± ××‘×˜×œ Overview ×‘×œ×—×™×¦×” ×¢×œ Super..."
gsettings set org.gnome.shell.keybindings toggle-overview "[]"

# ×§×•×‘×¢ workspaces ×§×‘×•×¢×™×
echo "ğŸ§© ×§×•×‘×¢ 6 ×©×•×œ×—× ×•×ª ×¢×‘×•×“×” ×§×‘×•×¢×™×..."
gsettings set org.gnome.desktop.wm.preferences num-workspaces 6

# ×××¤×¡ caches
echo "ğŸ§¹ ×× ×§×” cache ×©×œ GNOME..."
rm -rf ~/.cache/gnome-shell/*
rm -rf ~/.cache/fontconfig
fc-cache -f -v

# ×”××¦×ª gnome-shell
echo "âš¡ ××¢×œ×” ×¢×“×™×¤×•×ª ×©×œ gnome-shell..."
sudo renice -n -10 -p $(pgrep gnome-shell) >/dev/null 2>&1

# × ×™×§×•×™ GPU/Mutter × ×™×¡×™×•× ×™×™×
echo "ğŸ”§ ××•×•×“× ×©×”Ö¾scale-monitor-framebuffer ×¤×¢×™×œ..."
gsettings set org.gnome.mutter experimental-features "['scale-monitor-framebuffer']"

echo "âœ… ×‘×•×¦×¢! ×”×¤×¢×œ ××—×“×© ××ª GNOME (Alt+F2 â†’ r â†’ Enter) ××• ×”×ª× ×ª×§/×”×ª×—×‘×¨ ××—×“×©."
